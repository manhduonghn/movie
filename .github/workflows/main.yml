name: Build Android APK with EAS

on:
  workflow_dispatch:

jobs:
  build-android:
    runs-on: ubuntu-latest

    steps:
      - name: üì¶ Checkout source code
        uses: actions/checkout@main

      - name: üß© Install EAS CLI
        run: npm install -g eas-cli

      - name: üîê Authenticate Expo with Token
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
        run: echo "Expo token loaded"

      - name: üèóÔ∏è Ensure EAS project is configured
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
        run: |
          # N·∫øu ch∆∞a c√≥ project ID, t·ª± ƒë·ªông kh·ªüi t·∫°o
          if ! grep -q "projectId" app.json 2>/dev/null; then
            echo "üîß Project ch∆∞a c√≥ projectId, t·ª± ƒë·ªông kh·ªüi t·∫°o..."
            eas project:init --non-interactive || true
          else
            echo "‚úÖ Project ƒë√£ c√≥ projectId, b·ªè qua b∆∞·ªõc init"
          fi
          
      - name: üß± Build Android APK
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
          EAS_SKIP_AUTO_FINGERPRINT: 1
        run: |
          EAS_SKIP_AUTO_FINGERPRINT=1 eas build -p android --profile preview
